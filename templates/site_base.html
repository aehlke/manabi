{% extends "base.html" %}

{% load i18n %}
{% load account_tags %}
{% load ifsetting_tag %}

{% block extra_head_base %}
    {% include 'dojango/include.html' %}
    <link rel="stylesheet" href="{{ MEDIA_URL }}static/css/site_tabs.css" />
    <link rel="stylesheet" href="{{ MEDIA_URL }}static/css/misc.css" />
    {% block extra_head %}{% endblock %}
    {% if user.is_authenticated %}
        <script type="text/javascript" src="{{ MEDIA_URL }}static/js/manabi.js"></script>    
    {% else %}
        <script type="text/javascript">
            // don't allow IE users yet :( ... >:]
            dojo.addOnLoad(function() {
                if (dojo.isIE) {
                    dojo.byId('body_contents').innerHTML = "\
                    Unfortunately your browser, Internet Explorer, doesn't work with this site just yet.<br><br>\
                    Please use a more standards-compliant browser such as \
                    <a href=\"http://www.mozilla.com/firefox/\">Firefox</a>, \
                    <a href=\"http://www.google.com/chrome\">Google Chrome</a>, or <a href=\"http://www.apple.com/safari/\">Safari</a>.<br><br>\
                    Sorry for the inconvenience! We'll add IE support eventually!";
              }
            });

            {% if user.is_authenticated %}
                dojo.require('manabi_ui');
            {% endif %}

        </script>
    {% endif %}

    {% comment %}<script type="text/javascript" src="{{ MEDIA_URL }}static/js/pixastic.custom.js"></script>    
    <script type="text/javascript">
        // Desaturate our nav images
        /*
        dojo.ready(function() {
            var desaturate = function(node) {
                Pixastic.process(node, 'edges', { mono:true, invert:true });
            };
            dojo.query('#subnav a').forEach(function(node) {
                dojo.query('img', node).forEach(function(node) {
                    desaturate(node);
                });
                dojo.query('canvas', node).forEach(function(node) {
                    dojo.style(node, 'opacity', '.3');
                });
                dojo.query(node).onmouseenter(dojo.hitch(this, function() {
                    dojo.query('canvas', node).forEach(function(node) {
                        dojo.style(node, 'opacity', '1.0');
                        Pixastic.revert(node);
                        dojo.style(node, 'opacity', '1.0');
                    });
                }));
                dojo.query(node).parent().onmouseleave(dojo.hitch(this, function() {
                    dojo.query('img', node).forEach(function(node) {
                        desaturate(node);
                        dojo.style(node, 'opacity', '.3');
                    });
                }));
            });
        });*/
    </script>{% endcomment %}
{% endblock %}

{% block body_class %}{{ DOJANGO.THEME }}{% endblock %}

{% block login %}
    {% load i18n ifsetting_tag account_tags %}
    {% if user.is_authenticated %}
    <b>{% user_display user %}</b> {% comment %} | <a href="{% url acct_email %}">{% trans "Account" %}</a> {% endcomment %}| {% if user.is_staff %}<a href="/admin/">{% trans "Admin" %}</a> | {% endif %}<a href="{% url acct_logout %}">{% trans "Logout" %}</a>
    {% else %}
        <a href="{% url acct_login %}">{% trans "Login" %}</a> {% ifsetting ACCOUNT_OPEN_SIGNUP %}{% trans "or" %} <a href="{% url acct_signup %}"><b>{% trans "Sign up" %}</b></a>{% endifsetting %}
    {% endif %}
{% endblock %}

{% block logo_link_image %}
<div id="site_title_left"><!-- --></div>
<div id="site_title">
    {% if user.is_authenticated %}
        <a style="color:white;text-decoration:none;" href="{% url home_inline %}" onclick="manabi_ui.xhrLink(this.href);return false;">
    {% else %}
        <a style="color:white;text-decoration:none;" href="{% url home %}">
    {% endif %}
            <span id="site_logo">学</span>
            <span class="no_hover">Manabi</span><span class="hover">まなび</span>
        </a>
</div>
<div id="site_title_right"><!-- --></div>
{% endblock %}

{% block subnav %}
    <ul>
        {% comment %}
        <li><a href="{% url home_inline %}" id="subnav_home_link" class="xhr_link"><img src="http://c.dryicons.com/images/icon_sets/stickers_icon_set/png/48x48/home.png">Home</a>
        {% if user.is_authenticated %}
            <li><a href="{% url add_decks %}" id="subnav_add_link" class="xhr_link"><img src="http://c.dryicons.com/images/icon_sets/stickers_icon_set/png/48x48/add_item.png">Add</a>
            <li><a href="{% url decks %}" id="subnav_manage_link" class="xhr_link"><img src="http://c.dryicons.com/images/icon_sets/stickers_icon_set/png/48x48/note.png">Manage</a>


        {% endcomment %}
        {% if user.is_authenticated %}
            <li><a href="{% url home_inline %}" id="subnav_home_link" class="xhr_link" onmouseover="dojo.query('img', this)[0].src='{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/home.png';" onmouseout="dojo.query('img', this)[0].src='{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/home-outline.png';"><img src="{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/home-outline.png" >Home</a>
            <li class="active"><a href="{% url add_decks %}" id="subnav_add_link" class="xhr_link" onmouseover="dojo.query('img', this)[0].src='{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/add.png';" onmouseout="dojo.query('img', this)[0].src='{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/add-outline.png';"><img src="{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/add-outline.png" >Add</a>
            <li><a href="{% url decks %}" id="subnav_database_link" class="xhr_link" onmouseover="dojo.query('img', this)[0].src='{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/database.png';" onmouseout="dojo.query('img', this)[0].src='{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/database-outline.png';"><img src="{{ MEDIA_URL }}static/icons/colorful_stickers/48x48/database-outline.png" >Manage</a>
        {% endif %}
    </ul>
{% endblock %}

{% block right_tabs %}
{% comment %}
    {% if user.is_authenticated %}
        <ul class="tabs">{% spaceless %}
            <li id="tab_profile"><a href="{% url profile_detail user %}">{% trans "Profile" %}</a></li>
            <li id="tab_notices"><a href="{% url notification_notices %}">{% trans "Notices" %}{% if notice_unseen_count %} ({{ notice_unseen_count }}){% endif %}</a></li>
        {% endspaceless %}</ul>
    {% endif %}
{% endcomment %}
{% endblock %}

{% block body_outer %}
    <div id="column_wrap">
        {% if user.is_authenticated %}
            {% include "flashcards/base.html" %}
        {% endif %}
        
        <div id="body_contents">
            {% block body %}
            <div dojoType="dojox.layout.ContentPane" jsId="body_pane" style="overflow:hidden" executeScripts="true" scriptHasHooks="true">
                <script type="dojo/connect" event="onDownloadEnd">
                    manabi_ui.convertLinksToXhr(body_pane.domNode);            
                </script>
                {% block body_contents %}
                {% endblock %}
            </div>
            {% endblock %}
        </div>
    </div>
    <div jsId="manabi_standby" target="body_contents" dojoType="dojox.widget.Standby"></div>
{% endblock %}

{% block footer %}
<div class="legal">
    {% trans "&copy; Alex Ehlke 2011" %}{% if user.is_authenticated %}. 
    Feedback or support: <a href="mailto:manabi.org@gmail.com">manabi.org@gmail.com</a>
    {% endif %}
    {% comment %}
    <div class="sub_legal">
        Icons by <a href="http://dryicons.com">DryIcons</a>
    </div>
    {% endcomment %}
{% comment %}    - <a href="{% url about %}">{% trans "About" %}</a>
    - <a href="{% url terms %}">{% trans "Terms of Service" %}</a>
    - <a href="{% url privacy %}">{% trans "Privacy Policy" %}</a> {% endcomment %}
</div>
{% endblock %}


